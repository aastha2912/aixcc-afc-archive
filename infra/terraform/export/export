#!/bin/bash -eu
if [[ $# -ne 2 ]]; then
    echo >&2 "Usage: export <resource-group> <outdir>"
    exit 1
fi
basedir=$(cd "$(dirname "$0")" && pwd)
resource_group="$1"
mkdir -p "$2"
outdir=$(realpath "$2")

docker build --platform linux/amd64 "$basedir" -t azure-shell
docker run   --platform linux/amd64 --rm -it -v "$outdir:/opt/work" azure-shell sh -c "az login -t aixcc.tech && aztfexport rg --non-interactive --hcl-only -o /opt/work $resource_group"
